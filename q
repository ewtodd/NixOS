[1mdiff --git a/flake.nix b/flake.nix[m
[1mindex ed666e6..f7bac78 100755[m
[1m--- a/flake.nix[m
[1m+++ b/flake.nix[m
[36m@@ -1,5 +1,6 @@[m
 {[m
   description = "Managing all the devices!";[m
[32m+[m
   inputs = {[m
     nixpkgs.url = "github:NixOS/nixpkgs/nixos-25.11";[m
     unstable.url = "github:NixOS/nixpkgs/nixpkgs-unstable";[m
[36m@@ -49,43 +50,29 @@[m
       unstable,[m
       ...[m
     }:[m
[31m-    {[m
[31m-      nixosConfigurations = {[m
[31m-        v-desktop = nixpkgs.lib.nixosSystem {[m
[31m-          system = "x86_64-linux";[m
[31m-          specialArgs = {[m
[31m-            inherit inputs;[m
[31m-            system = "x86_64-linux";[m
[31m-          };[m
[31m-          modules = [[m
[31m-            ./modules[m
[31m-            inputs.home-manager.nixosModules.home-manager[m
[31m-            inputs.dank-material-shell.nixosModules.greeter[m
[31m-            {[m
[31m-              nixpkgs.config.allowUnfree = true;[m
[31m-              home-manager = {[m
[31m-                useGlobalPkgs = true;[m
[31m-                useUserPackages = true;[m
[31m-                backupFileExtension = "hm-backup";[m
[31m-                sharedModules = [[m
[31m-                  inputs.nixvim.homeModules.nixvim[m
[31m-                  inputs.nix-colors.homeManagerModules.default[m
[31m-                  inputs.dank-material-shell.homeModules.dank-material-shell[m
[31m-                  inputs.danksearch.homeModules.dsearch[m
[31m-                  inputs.dms-plugin-registry.modules.default[m
[31m-                  inputs.niri-nix.homeModules.default[m
[31m-                  {[m
[31m-                    programs.nixvim.nixpkgs.useGlobalPackages = true;[m
[31m-                  }[m
[31m-                ];[m
[31m-                extraSpecialArgs = { inherit inputs; };[m
[31m-                users = import ./hosts/v-desktop/home.nix;[m
[31m-              };[m
[31m-            }[m
[31m-            ./hosts/v-desktop/configuration.nix[m
[31m-          ];[m
[31m-        };[m
[31m-        e-desktop = nixpkgs.lib.nixosSystem {[m
[32m+[m[32m    let[m
[32m+[m[32m      # Helper to create home-manager shared modules[m
[32m+[m[32m      mkHomeManagerSharedModules = inputs: [[m
[32m+[m[32m        inputs.nixvim.homeModules.nixvim[m
[32m+[m[32m        inputs.nix-colors.homeManagerModules.default[m
[32m+[m[32m        inputs.dank-material-shell.homeModules.dank-material-shell[m
[32m+[m[32m        inputs.danksearch.homeModules.dsearch[m
[32m+[m[32m        inputs.dms-plugin-registry.modules.default[m
[32m+[m[32m        inputs.niri-nix.homeModules.default[m
[32m+[m[32m        {[m
[32m+[m[32m          programs.nixvim.nixpkgs.useGlobalPackages = true;[m
[32m+[m[32m        }[m
[32m+[m[32m      ];[m
[32m+[m
[32m+[m[32m      # Helper to create a NixOS system configuration[m
[32m+[m[32m      # hostname: name of the host (e.g., "v-desktop")[m
[32m+[m[32m      # useLanzaboote: whether to include lanzaboote module (for secure boot)[m
[32m+[m[32m      mkNixOSSystem =[m
[32m+[m[32m        {[m
[32m+[m[32m          hostname,[m
[32m+[m[32m          useLanzaboote ? false,[m
[32m+[m[32m        }:[m
[32m+[m[32m        nixpkgs.lib.nixosSystem {[m
           system = "x86_64-linux";[m
           specialArgs = {[m
             inherit inputs;[m
[36m@@ -97,7 +84,6 @@[m
           };[m
           modules = [[m
             ./modules[m
[31m-            inputs.lanzaboote.nixosModules.lanzaboote[m
             inputs.home-manager.nixosModules.home-manager[m
             inputs.dank-material-shell.nixosModules.greeter[m
             {[m
[36m@@ -106,92 +92,31 @@[m
                 useGlobalPkgs = true;[m
                 useUserPackages = true;[m
                 backupFileExtension = "hm-backup";[m
[31m-                sharedModules = [[m
[31m-                  inputs.nixvim.homeModules.nixvim[m
[31m-                  inputs.nix-colors.homeManagerModules.default[m
[31m-                  inputs.dank-material-shell.homeModules.dank-material-shell[m
[31m-                  inputs.danksearch.homeModules.dsearch[m
[31m-                  inputs.dms-plugin-registry.modules.default[m
[31m-                  inputs.niri-nix.homeModules.default[m
[31m-                  {[m
[31m-                    programs.nixvim.nixpkgs.useGlobalPackages = true;[m
[31m-                  }[m
[31m-                ];[m
[31m-                extraSpecialArgs = { inherit inputs; };[m
[31m-                users = import ./hosts/e-desktop/home.nix;[m
[32m+[m[32m                sharedModules = mkHomeManagerSharedModules inputs;[m
[32m+[m[32m                extraSpecialArgs = {[m
[32m+[m[32m                  inherit inputs;[m
[32m+[m[32m                };[m
[32m+[m[32m                users = import ./hosts/${hostname}/home.nix;[m
               };[m
             }[m
[31m-            ./hosts/e-desktop/configuration.nix[m
[32m+[m[32m            ./hosts/${hostname}/configuration.nix[m
[32m+[m[32m          ][m
[32m+[m[32m          ++ nixpkgs.lib.optionals useLanzaboote [[m
[32m+[m[32m            inputs.lanzaboote.nixosModules.lanzaboote[m
           ];[m
         };[m
[31m-        v-laptop = nixpkgs.lib.nixosSystem {[m
[31m-          system = "x86_64-linux";[m
[31m-          specialArgs = {[m
[31m-            inherit inputs;[m
[31m-            system = "x86_64-linux";[m
[31m-          };[m
[31m-          modules = [[m
[31m-            ./modules[m
[31m-            inputs.home-manager.nixosModules.home-manager[m
[31m-            inputs.dank-material-shell.nixosModules.greeter[m
[31m-            {[m
[31m-              nixpkgs.config.allowUnfree = true;[m
[31m-              home-manager = {[m
[31m-                useGlobalPkgs = true;[m
[31m-                useUserPackages = true;[m
[31m-                backupFileExtension = "hm-backup";[m
[31m-                sharedModules = [[m
[31m-                  inputs.nixvim.homeModules.nixvim[m
[31m-                  inputs.nix-colors.homeManagerModules.default[m
[31m-                  inputs.dank-material-shell.homeModules.dank-material-shell[m
[31m-                  inputs.danksearch.homeModules.dsearch[m
[31m-                  inputs.dms-plugin-registry.modules.default[m
[31m-                  inputs.niri-nix.homeModules.default[m
[31m-                  {[m
[31m-                    programs.nixvim.nixpkgs.useGlobalPackages = true;[m
[31m-                  }[m
[31m-                ];[m
[31m-                extraSpecialArgs = { inherit inputs; };[m
[31m-                users = import ./hosts/v-laptop/home.nix;[m
[31m-              };[m
[31m-            }[m
[31m-            ./hosts/v-laptop/configuration.nix[m
[31m-          ];[m
[32m+[m[32m    in[m
[32m+[m[32m    {[m
[32m+[m[32m      nixosConfigurations = {[m
[32m+[m[32m        v-desktop = mkNixOSSystem { hostname = "v-desktop"; };[m
[32m+[m[32m        v-laptop = mkNixOSSystem { hostname = "v-laptop"; };[m
[32m+[m[32m        e-desktop = mkNixOSSystem {[m
[32m+[m[32m          hostname = "e-desktop";[m
[32m+[m[32m          useLanzaboote = true;[m
         };[m
[31m-        e-laptop = nixpkgs.lib.nixosSystem {[m
[31m-          system = "x86_64-linux";[m
[31m-          specialArgs = {[m
[31m-            inherit inputs;[m
[31m-            system = "x86_64-linux";[m
[31m-          };[m
[31m-          modules = [[m
[31m-            ./modules[m
[31m-            inputs.home-manager.nixosModules.home-manager[m
[31m-            inputs.dank-material-shell.nixosModules.greeter[m
[31m-            inputs.lanzaboote.nixosModules.lanzaboote[m
[31m-            {[m
[31m-              nixpkgs.config.allowUnfree = true;[m
[31m-              home-manager = {[m
[31m-                useGlobalPkgs = true;[m
[31m-                useUserPackages = true;[m
[31m-                backupFileExtension = "hm-backup";[m
[31m-                sharedModules = [[m
[31m-                  inputs.nixvim.homeModules.nixvim[m
[31m-                  inputs.nix-colors.homeManagerModules.default[m
[31m-                  inputs.dank-material-shell.homeModules.dank-material-shell[m
[31m-                  inputs.danksearch.homeModules.dsearch[m
[31m-                  inputs.dms-plugin-registry.modules.default[m
[31m-                  inputs.niri-nix.homeModules.default[m
[31m-                  {[m
[31m-                    programs.nixvim.nixpkgs.useGlobalPackages = true;[m
[31m-                  }[m
[31m-                ];[m
[31m-                extraSpecialArgs = { inherit inputs; };[m
[31m-                users = import ./hosts/e-laptop/home.nix;[m
[31m-              };[m
[31m-            }[m
[31m-            ./hosts/e-laptop/configuration.nix[m
[31m-          ];[m
[32m+[m[32m        e-laptop = mkNixOSSystem {[m
[32m+[m[32m          hostname = "e-laptop";[m
[32m+[m[32m          useLanzaboote = true;[m
         };[m
       };[m
     };[m
[1mdiff --git a/home-manager/desktopEnvironment/niri/default.nix b/home-manager/desktopEnvironment/niri/default.nix[m
[1mindex 2519bcd..01e78d6 100755[m
[1m--- a/home-manager/desktopEnvironment/niri/default.nix[m
[1m+++ b/home-manager/desktopEnvironment/niri/default.nix[m
[36m@@ -26,7 +26,9 @@[m [mlet[m
   open-private-window = "${pkgs.firefox}/bin/firefox --private-window";[m
   notificationColor = if (colors.base08 != colors.base0E) then colors.base08 else "F84F31";[m
   gaps = if e then "12" else "8";[m
[31m-  unstable = import inputs.unstable { system = "x86_64-linux"; };[m
[32m+[m[32m  unstable = import inputs.unstable {[m
[32m+[m[32m    system = pkgs.stdenv.hostPlatform.system;[m
[32m+[m[32m  };[m
 in[m
 {[m
   imports = [[m
[1mdiff --git a/home-manager/packages/ai/default.nix b/home-manager/packages/ai/default.nix[m
[1mindex 0fed6be..6e481b6 100755[m
[1m--- a/home-manager/packages/ai/default.nix[m
[1m+++ b/home-manager/packages/ai/default.nix[m
[36m@@ -6,7 +6,7 @@[m
   ...[m
 }:[m
 let[m
[31m-  unstable = inputs.unstable.legacyPackages.${pkgs.system};[m
[32m+[m[32m  unstable = inputs.unstable.legacyPackages.${pkgs.stdenv.hostPlatform.system};[m
 in[m
 {[m
   config = lib.mkIf (osConfig.systemOptions.services.ai.enable) {[m
[1mdiff --git a/home-manager/packages/default.nix b/home-manager/packages/default.nix[m
[1mindex 5a98881..50f9b00 100755[m
[1m--- a/home-manager/packages/default.nix[m
[1m+++ b/home-manager/packages/default.nix[m
[36m@@ -8,8 +8,8 @@[m
 }:[m
 let[m
   profile = config.Profile;[m
[31m-  lisepp = inputs.lisepp.packages."x86_64-linux".default;[m
[31m-  SRIM = inputs.SRIM.packages."x86_64-linux".default;[m
[32m+[m[32m  lisepp = inputs.lisepp.packages.${pkgs.stdenv.hostPlatform.system}.default;[m
[32m+[m[32m  SRIM = inputs.SRIM.packages.${pkgs.stdenv.hostPlatform.system}.default;[m
   rootbrowse_bin = pkgs.writeShellScriptBin "rootbrowse_bin" "${pkgs.root}/bin/rootbrowse --web=off";[m
   rootbrowse_desktop = pkgs.makeDesktopItem {[m
     name = "rootbrowse";[m
[36m@@ -24,7 +24,7 @@[m [mlet[m
       rootbrowse_desktop[m
     ];[m
   };[m
[31m-  unstable = inputs.unstable.legacyPackages.${pkgs.system};[m
[32m+[m[32m  unstable = inputs.unstable.legacyPackages.${pkgs.stdenv.hostPlatform.system};[m
 in[m
 {[m
   imports = [[m
[1mdiff --git a/home-manager/packages/nixvim/keymaps.nix b/home-manager/packages/nixvim/keymaps.nix[m
[1mindex 9799221..e93b817 100755[m
[1m--- a/home-manager/packages/nixvim/keymaps.nix[m
[1m+++ b/home-manager/packages/nixvim/keymaps.nix[m
[36m@@ -329,5 +329,41 @@[m
         nowait = true;[m
       };[m
     }[m
[32m+[m[32m    {[m
[32m+[m[32m      action = "<cmd>ClaudeCode<CR>";[m
[32m+[m[32m      key = "<leader>cc";[m
[32m+[m[32m      mode = [ "n" ];[m
[32m+[m[32m      options = {[m
[32m+[m[32m        desc = "Toggle Claude Code";[m
[32m+[m[32m        nowait = true;[m
[32m+[m[32m      };[m
[32m+[m[32m    }[m
[32m+[m[32m    {[m
[32m+[m[32m      action = "<cmd>ClaudeCodeContinue<CR>";[m
[32m+[m[32m      key = "<leader>cC";[m
[32m+[m[32m      mode = [ "n" ];[m
[32m+[m[32m      options = {[m
[32m+[m[32m        desc = "Claude Code: Continue last conversation";[m
[32m+[m[32m        nowait = true;[m
[32m+[m[32m      };[m
[32m+[m[32m    }[m
[32m+[m[32m    {[m
[32m+[m[32m      action = "<cmd>ClaudeCodeResume<CR>";[m
[32m+[m[32m      key = "<leader>cr";[m
[32m+[m[32m      mode = [ "n" ];[m
[32m+[m[32m      options = {[m
[32m+[m[32m        desc = "Claude Code: Resume conversation (picker)";[m
[32m+[m[32m        nowait = true;[m
[32m+[m[32m      };[m
[32m+[m[32m    }[m
[32m+[m[32m    {[m
[32m+[m[32m      action = "<cmd>ClaudeCodeVerbose<CR>";[m
[32m+[m[32m      key = "<leader>cv";[m
[32m+[m[32m      mode = [ "n" ];[m
[32m+[m[32m      options = {[m
[32m+[m[32m        desc = "Claude Code: Verbose mode";[m
[32m+[m[32m        nowait = true;[m
[32m+[m[32m      };[m
[32m+[m[32m    }[m
   ];[m
 }[m
[1mdiff --git a/modules/desktopEnvironment/default.nix b/modules/desktopEnvironment/default.nix[m
[1mindex 14da664..b7edb4a 100755[m
[1m--- a/modules/desktopEnvironment/default.nix[m
[1m+++ b/modules/desktopEnvironment/default.nix[m
[36m@@ -6,7 +6,9 @@[m
   ...[m
 }:[m
 let[m
[31m-  unstable = import inputs.unstable { system = "x86_64-linux"; };[m
[32m+[m[32m  unstable = import inputs.unstable {[m
[32m+[m[32m    system = pkgs.stdenv.hostPlatform.system;[m
[32m+[m[32m  };[m
   homeDirectory = if (config.systemOptions.owner.e.enable) then "/home/e-play" else "/home/v-play";[m
 in[m
 {[m
[1mdiff --git a/modules/hardware/default.nix b/modules/hardware/default.nix[m
[1mindex d1adee3..f83cab9 100755[m
[1m--- a/modules/hardware/default.nix[m
[1m+++ b/modules/hardware/default.nix[m
[36m@@ -6,7 +6,7 @@[m
   ...[m
 }:[m
 let[m
[31m-  unstable = inputs.unstable.legacyPackages.${pkgs.system};[m
[32m+[m[32m  unstable = inputs.unstable.legacyPackages.${pkgs.stdenv.hostPlatform.system};[m
   cb-ucm-conf = pkgs.alsa-ucm-conf.overrideAttrs {[m
     wttsrc = pkgs.fetchurl {[m
       url = "https://github.com/WeirdTreeThing/chromebook-ucm-conf/archive/1328e46bfca6db2c609df9c68d37bb418e6fe279.tar.gz";[m
[1mdiff --git a/modules/packages/default.nix b/modules/packages/default.nix[m
[1mindex 63b650a..a9ef59e 100755[m
[1m--- a/modules/packages/default.nix[m
[1m+++ b/modules/packages/default.nix[m
[36m@@ -6,8 +6,8 @@[m
   ...[m
 }:[m
 let[m
[31m-  unstable = inputs.unstable.legacyPackages.${pkgs.system};[m
[31m-  remarkable = inputs.remarkable.packages."x86_64-linux".default;[m
[32m+[m[32m  unstable = inputs.unstable.legacyPackages.${pkgs.stdenv.hostPlatform.system};[m
[32m+[m[32m  remarkable = inputs.remarkable.packages.${pkgs.stdenv.hostPlatform.system}.default;[m
   e = config.systemOptions.owner.e.enable;[m
 in[m
 {[m
[1mdiff --git a/modules/services/default.nix b/modules/services/default.nix[m
[1mindex c1e3534..2853584 100755[m
[1m--- a/modules/services/default.nix[m
[1m+++ b/modules/services/default.nix[m
[36m@@ -6,7 +6,7 @@[m
   ...[m
 }:[m
 let[m
[31m-  unstable = inputs.unstable.legacyPackages.${pkgs.system};[m
[32m+[m[32m  unstable = inputs.unstable.legacyPackages.${pkgs.stdenv.hostPlatform.system};[m
 in[m
 {[m
   config = lib.mkMerge [[m
